# 阶段一：向量生成性能测试配置

# Xinference 服务配置
xinference:
  host: "192.168.1.51"
  port: 9997
  timeout: 300

# 测试模型列表（按顺序串行测试）
models:
  - name: "bge-m3"
    model_name: "BAAI/bge-m3"
    dimensions: 1024
    max_tokens: 8192
    batch_sizes: [8, 16, 32, 64]
    
  - name: "qwen2.5-0.6b"
    model_name: "Qwen/Qwen2.5-Embedding-0.6B"
    dimensions: 1024
    max_tokens: 8192
    batch_sizes: [8, 16, 32, 64]
    
  - name: "qwen2.5-4b"
    model_name: "Qwen/Qwen2.5-Embedding-4B"
    dimensions: 2560
    max_tokens: 8192
    batch_sizes: [8, 16, 32]  # 显存较大，减少batch size
    
  - name: "qwen2.5-8b"
    model_name: "Qwen/Qwen2.5-Embedding-8B"
    dimensions: 4096
    max_tokens: 8192
    batch_sizes: [4, 8, 16]  # 显存最大，进一步减少batch size

# 数据集配置
dataset:
  name: "benchmark_dataset"  # 数据集名称（仅用于日志）
  path: "data/dataset"  # 数据集路径
  sample_size: 3000000  # 目标采样数量（实际使用 min(sample_size, 文件行数)）
  seed: 42  # 随机种子
  max_length: 512  # 最大文本长度
  min_length: 10  # 最小文本长度

# 推理性能测试配置
inference_benchmark:
  # 单样本延迟测试
  latency_test:
    num_samples: 1000
    warmup_samples: 100
    
  # 批处理吞吐量测试
  throughput_test:
    num_batches: 100
    warmup_batches: 10
    
  # 显存监控
  gpu_monitor:
    interval: 1  # 秒
    
# 向量缓存配置
vector_cache:
  format: "hdf5"
  output_dir: "vector_cache"
  compression: "gzip"
  compression_level: 4
  chunk_size: 10000

# 报告生成配置
report:
  output_dir: "phase1_results"
  format: "html"
  include_plots: true
  plot_style: "plotly"  # 交互式图表
  
  # 推算配置
  extrapolate:
    scales: [5000000, 10000000, 50000000, 100000000]  # 500万、1000万、5000万、1亿
    
# 日志配置
logging:
  level: "INFO"
  log_dir: "logs"
  log_file: "phase1.log"
  console_output: true
  file_output: true

# 串行执行配置
serial_execution:
  enabled: true  # 强制串行
  cleanup_between_models: true  # 模型间清理显存
  pause_between_models: 5  # 模型间暂停秒数

# 分批测试配置（用于显存不足时）
# 如果定义了批次，可以通过 --batch 参数指定要运行的批次
# 例如：python run_phase1.py --config ../config/phase1_config.yaml --batch 1
batch_groups:
  # 第一批：较小的模型（显存占用较小）
  - batch_id: 1
    batch_name: "small_models"
    model_names:
      - "bge-m3"
      - "qwen2.5-0.6b"
  
  # 第二批：较大的模型（显存占用较大）
  - batch_id: 2
    batch_name: "large_models"
    model_names:
      - "qwen2.5-4b"
      - "qwen2.5-8b"
